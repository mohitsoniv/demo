pipeline {
  agent any

  // Make sure these tool names exist in Manage Jenkins â†’ Global Tool Configuration
  tools {
    jdk 'JDK11'         // <-- change to the exact name you configured for your JDK
    maven 'MAVEN_HOME'  // <-- change to the exact name you configured for Maven
  }

  environment {
    MVN_ARGS = '-B' // batch mode; add other common mvn args here if needed
  }

  stages {
    stage('Verify Tools') {
      steps {
        // Print environment and versions so we can debug quickly if something is missing
        bat 'echo ========== ENV =========='
        bat 'echo JAVA_HOME=%JAVA_HOME%'
        bat 'echo PATH=%PATH%'
        bat 'echo ========== JAVA =========='
        bat 'where java || echo java not found'
        bat 'java -version || echo java -version failed'
        bat 'echo ========== MAVEN =========='
        bat 'where mvn || echo mvn not found'
        bat 'mvn -version || echo mvn -version failed'
      }
    }

    stage('Welcome Stage') {
      steps {
        echo "Welcome to Jenkins Stage"
      }
    }

    stage('Clean') {
      steps {
        // mvn clean will fail if JAVA_HOME is not set correctly
        bat 'mvn clean'
      }
    }

    stage('Build') {
      steps {
        bat "mvn install ${env.MVN_ARGS}"
      }
    }

    stage('Success Stage') {
      steps {
        echo "Pipeline executed successfully"
      }
    }
  }

  post {
    always {
      echo "Pipeline finished with status: ${currentBuild.currentResult}"
    }
    failure {
      echo "Failure post actions: verify that the JDK and Maven tool names match Global Tool Configuration and that JAVA_HOME is available on the agent."
    }
  }
}
